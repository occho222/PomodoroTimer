<Window x:Class="PomodoroTimer.Views.TaskDetailDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:models="clr-namespace:PomodoroTimer.Models"
        Title="ã‚¿ã‚¹ã‚¯è©³ç´°" 
        Height="700" Width="900"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        Background="{StaticResource BackgroundLight}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <Border Grid.Row="0" Background="White" Margin="10,10,10,5" CornerRadius="12" Padding="20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0">
                    <TextBox Text="{Binding TaskTitle, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                             FontSize="20" FontWeight="Bold" 
                             Background="White" BorderThickness="1" BorderBrush="#E0E0E0"
                             Foreground="{StaticResource TextLight}"
                             TextWrapping="Wrap" Padding="8,4"/>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                        <ComboBox ItemsSource="{Binding AvailableStatuses}"
                                  SelectedItem="{Binding SelectedStatus, Mode=TwoWay}"
                                  Style="{StaticResource FilterComboBox}" Width="100" Margin="0,0,10,0"/>
                        <ComboBox ItemsSource="{Binding AvailablePriorities}"
                                  SelectedItem="{Binding SelectedPriority, Mode=TwoWay}"
                                  Style="{StaticResource FilterComboBox}" Width="100" Margin="0,0,10,0"/>
                        <Grid Width="140" Margin="0,0,10,0">
                            <ComboBox x:Name="ProjectComboBox"
                                      Text="{Binding TaskCategory, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                      ItemsSource="{Binding AvailableProjects}"
                                      IsEditable="True"
                                      Style="{StaticResource FilterComboBox}"
                                      ToolTip="ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã¾ãŸã¯é¸æŠž"/>
                            <TextBlock Text="ðŸ“" FontSize="16" 
                                       HorizontalAlignment="Right" VerticalAlignment="Center" 
                                       Margin="0,0,20,0" IsHitTestVisible="False"
                                       Foreground="#6B7280"/>
                        </Grid>
                    </StackPanel>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="ðŸ“Ž" ToolTip="ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜" 
                            Command="{Binding AddAttachmentCommand}"
                            Style="{StaticResource KanbanActionButton}"
                            Background="{StaticResource SecondaryBrush}" Margin="5,0"/>
                    <Button Content="ðŸ“·" ToolTip="ç”»åƒè²¼ã‚Šä»˜ã‘" 
                            Command="{Binding PasteImageCommand}"
                            Style="{StaticResource KanbanActionButton}"
                            Background="{StaticResource AccentBrush}" Margin="5,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <Grid Grid.Row="1" Margin="10,5,10,5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- å·¦å´ï¼šè©³ç´°æƒ…å ± -->
            <Border Grid.Column="0" Background="White" Margin="0,0,5,0" CornerRadius="12" Padding="15">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>

                        <!-- ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ -->
                        <Grid Margin="0,0,0,15">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" Text="ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                            
                            <Grid Grid.Row="1" Margin="0,0,0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="NewChecklistItemText" Grid.Column="0" 
                                         Style="{StaticResource SearchTextBox}"
                                         ToolTip="æ–°ã—ã„ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆé …ç›®"
                                         KeyDown="NewChecklistItem_KeyDown"/>
                                <Button Grid.Column="1" Content="è¿½åŠ " 
                                        Command="{Binding AddChecklistItemCommand}"
                                        CommandParameter="{Binding ElementName=NewChecklistItemText, Path=Text}"
                                        Style="{StaticResource RoundButton}" 
                                        Background="{StaticResource AccentBrush}" Margin="5,0,0,0"/>
                            </Grid>
                            
                            <ItemsControl Grid.Row="2" ItemsSource="{Binding ChecklistItems}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#F8FAFC" CornerRadius="6" Padding="8" Margin="0,2">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <CheckBox Grid.Column="0" IsChecked="{Binding IsChecked, Mode=TwoWay}"
                                                          VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                <TextBlock Grid.Column="1" Text="{Binding Text}" 
                                                           VerticalAlignment="Center" TextWrapping="Wrap">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsChecked}" Value="True">
                                                                    <Setter Property="TextDecorations" Value="Strikethrough"/>
                                                                    <Setter Property="Foreground" Value="Gray"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                                <Button Grid.Column="2" Content="ðŸ—‘" 
                                                        Command="{Binding DataContext.RemoveChecklistItemCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}"
                                                        Style="{StaticResource KanbanActionButton}"
                                                        Background="#EF4444" FontSize="12"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Grid>

                        <!-- èª¬æ˜Ž -->
                        <TextBlock Text="èª¬æ˜Ž" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                        <TextBox Text="{Binding Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                 Height="200" Margin="0,0,0,15"
                                 TextWrapping="Wrap" AcceptsReturn="True" AcceptsTab="True"
                                 VerticalScrollBarVisibility="Auto"
                                 HorizontalScrollBarVisibility="Disabled"/>

                        <!-- ãƒªãƒ³ã‚¯ -->
                        <TextBlock Text="ãƒªãƒ³ã‚¯" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                        <Grid Margin="0,0,0,15">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- ãƒªãƒ³ã‚¯ãƒªã‚¹ãƒˆ -->
                            <ScrollViewer Grid.Row="0" MaxHeight="120" VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding LinkItems}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#F0F9FF" CornerRadius="6" Padding="8" Margin="0,2">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    
                                                    <TextBlock Grid.Column="0" Text="ðŸ”—" FontSize="16" 
                                                               VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                    <TextBox Grid.Column="1" Text="{Binding Title, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                             Margin="0,0,4,0" VerticalAlignment="Center" 
                                                             ToolTip="ãƒªãƒ³ã‚¯ã®è¡¨ç¤ºå"/>
                                                    <TextBox Grid.Column="2" Text="{Binding Url, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                             Margin="4,0,8,0" VerticalAlignment="Center"
                                                             ToolTip="https://example.com ã®ã‚ˆã†ãªå½¢å¼"/>
                                                    <Button Grid.Column="3" Content="ðŸ—‘" 
                                                            Command="{Binding DataContext.RemoveLinkItemCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}"
                                                            Style="{StaticResource KanbanActionButton}"
                                                            Background="#EF4444" FontSize="12"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                            
                            <!-- ãƒªãƒ³ã‚¯è¿½åŠ ãƒœã‚¿ãƒ³ -->
                            <Button Grid.Row="1" Content="+ ãƒªãƒ³ã‚¯è¿½åŠ " 
                                    Command="{Binding AddLinkItemCommand}"
                                    HorizontalAlignment="Left" Margin="0,5,0,0" Padding="8,4"
                                    Background="#F0F9FF" BorderBrush="#3B82F6"/>
                        </Grid>

                        <!-- æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ« -->
                        <TextBlock Text="æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                        <ItemsControl ItemsSource="{Binding AttachmentItems}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#F0F9FF" CornerRadius="6" Padding="8" Margin="0,2">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <TextBlock Grid.Column="0" Text="ðŸ“Ž" FontSize="16" 
                                                       VerticalAlignment="Center" Margin="0,0,8,0"/>
                                            <TextBlock Grid.Column="1" Text="{Binding FileName}" 
                                                       VerticalAlignment="Center" TextWrapping="Wrap"/>
                                            <Button Grid.Column="2" Content="ðŸ“‚" ToolTip="é–‹ã"
                                                    Command="{Binding DataContext.OpenAttachmentCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"
                                                    Style="{StaticResource KanbanActionButton}"
                                                    Background="Transparent" Margin="5,0"/>
                                            <Button Grid.Column="3" Content="ðŸ—‘" ToolTip="å‰Šé™¤"
                                                    Command="{Binding DataContext.RemoveAttachmentCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}"
                                                    Style="{StaticResource KanbanActionButton}"
                                                    Background="Transparent"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- å³å´ï¼šãƒ¡ã‚¿æƒ…å ± -->
            <Border Grid.Column="1" Background="White" Margin="5,0,0,0" CornerRadius="12" Padding="15">
                <StackPanel>
                    <!-- æœŸé™ -->
                    <TextBlock Text="æœŸé™" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                    <DatePicker SelectedDate="{Binding DueDate, Mode=TwoWay}" 
                                Margin="0,0,0,5"/>
                    <!-- ã‚¯ã‚¤ãƒƒã‚¯é¸æŠžãƒœã‚¿ãƒ³ -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                        <Button Content="ä»Šæ—¥" Command="{Binding SetTodayCommand}" 
                                Style="{StaticResource RoundButton}" Background="#3B82F6" Foreground="White"
                                FontSize="11" Padding="8,4" Margin="0,0,5,0"/>
                        <Button Content="æ˜Žæ—¥" Command="{Binding SetTomorrowCommand}" 
                                Style="{StaticResource RoundButton}" Background="#10B981" Foreground="White"
                                FontSize="11" Padding="8,4" Margin="0,0,5,0"/>
                        <Button Content="æ˜Žå¾Œæ—¥" Command="{Binding SetDayAfterTomorrowCommand}" 
                                Style="{StaticResource RoundButton}" Background="#F59E0B" Foreground="White"
                                FontSize="11" Padding="8,4"/>
                    </StackPanel>

                    <!-- æ™‚é–“è¦‹ç©ã‚‚ã‚Š -->
                    <TextBlock Text="è¦‹ç©ã‚‚ã‚Šæ™‚é–“" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                        <TextBox Text="{Binding EstimatedMinutes, Mode=TwoWay}" 
                                 Width="60" Margin="0,0,5,0"/>
                        <TextBlock Text="åˆ†" VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- å®Ÿéš›ã®ä½œæ¥­æ™‚é–“ -->
                    <TextBlock Text="å®Ÿéš›ã®ä½œæ¥­æ™‚é–“" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                        <TextBox Text="{Binding ActualMinutes, Mode=TwoWay}" 
                                 Width="60" Margin="0,0,5,0"/>
                        <TextBlock Text="åˆ†" VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- ã‚¿ã‚° -->
                    <TextBlock Text="ã‚¿ã‚°" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                    <Grid Margin="0,0,0,5">
                        <TextBox x:Name="TagsTextBox"
                                 Text="{Binding TaskTags, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                 TextWrapping="Wrap" Height="60" AcceptsReturn="True"
                                 ToolTip="ã‚«ãƒ³ãƒžåŒºåˆ‡ã‚Šã§ã‚¿ã‚°ã‚’å…¥åŠ›ï¼ˆä¾‹: é–‹ç™º,UI,ä¿®æ­£ï¼‰"/>
                        <TextBlock Text="ðŸ·ï¸" FontSize="16" 
                                   HorizontalAlignment="Right" VerticalAlignment="Top" 
                                   Margin="0,5,5,0" IsHitTestVisible="False"
                                   Foreground="#6B7280"/>
                    </Grid>
                    
                    <!-- ã‚ˆãä½¿ã†ã‚¿ã‚°ãƒœã‚¿ãƒ³ -->
                    <TextBlock Text="ã‚ˆãä½¿ã†ã‚¿ã‚°:" FontSize="12" Foreground="Gray" Margin="0,0,0,5"/>
                    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" 
                                  Height="35" Margin="0,0,0,15">
                        <ItemsControl ItemsSource="{Binding PopularTags}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Content="{Binding}" 
                                            Command="{Binding DataContext.AddTagCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}"
                                            Style="{StaticResource RoundButton}" 
                                            Background="#E5E7EB" Foreground="#374151"
                                            FontSize="10" Padding="6,2" Margin="2,0" Height="24"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <!-- é€²æ—æƒ…å ± -->
                    <TextBlock Text="é€²æ—æƒ…å ±" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                    <StackPanel Margin="0,0,0,15">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="æ™‚é–“é€²æ—: " FontSize="12"/>
                            <TextBlock Text="{Binding ProgressPercentage, StringFormat={}{0:F1}%}" 
                                       FontSize="12" FontWeight="Bold"/>
                        </StackPanel>
                        <ProgressBar Value="{Binding ProgressPercentage}" Maximum="100" 
                                     Height="6" Margin="0,0,0,5"/>
                        
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ: " FontSize="12"/>
                            <TextBlock Text="{Binding ChecklistCompletionPercentage, StringFormat={}{0:F1}%}" 
                                       FontSize="12" FontWeight="Bold"/>
                        </StackPanel>
                        <ProgressBar Value="{Binding ChecklistCompletionPercentage}" Maximum="100" 
                                     Height="6"/>
                    </StackPanel>

                    <!-- ä½œæˆãƒ»æ›´æ–°æ—¥æ™‚ -->
                    <TextBlock Text="ä½œæˆæ—¥æ™‚" FontWeight="Bold" FontSize="12" Margin="0,0,0,2"/>
                    <TextBlock Text="{Binding CreatedAt, StringFormat={}{0:yyyy/MM/dd HH:mm}}" 
                               FontSize="11" Foreground="Gray" Margin="0,0,0,10"/>
                               
                    <TextBlock Text="æ›´æ–°æ—¥æ™‚" FontWeight="Bold" FontSize="12" Margin="0,0,0,2"
                               Visibility="{Binding StartedAt, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    <TextBlock Text="{Binding StartedAt, StringFormat={}{0:yyyy/MM/dd HH:mm}}" 
                               FontSize="11" Foreground="Gray"
                               Visibility="{Binding StartedAt, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <Border Grid.Row="2" Background="White" Margin="10,5,10,10" CornerRadius="12" Padding="15">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="ã‚­ãƒ£ãƒ³ã‚»ãƒ«" Command="{Binding CancelCommand}"
                        Style="{StaticResource RoundButton}" Background="Gray" Margin="0,0,10,0"/>
                <Button Content="ä¿å­˜" Command="{Binding SaveCommand}"
                        Style="{StaticResource RoundButton}" Background="{StaticResource AccentBrush}"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>